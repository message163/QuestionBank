import{u as q,c as M,a as O,d as E}from"./hooks-a57XDXS2.js";import{d as T,v as D,b as R,r as w,x as J,y as A,k as z,w as t,E as x,c as i,o as F,g as V,f as o,h as u,e as I,u as k,F as L,q as S,t as $,z as P,A as j}from"./index-bH1KA4aG.js";const G={class:"dialog-footer"},H=T({__name:"create",props:{modelValue:{type:Boolean,required:!0,default:!1},modelModifiers:{}},emits:D(["on-submit"],["update:modelValue"]),setup(U,{expose:f,emit:h}){const a=R({name:"",desc:"",_id:""}),c=R({name:[{required:!0,trigger:"change",message:"请输入名称"},{message:"请输入名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"change"},{message:"请输入描述",trigger:"blur"}]}),C=h,g=w(),b=w(!1),y=J(U,"modelValue");A(y,s=>{b.value=s});const r=()=>{y.value=!1},n=()=>{var s;(s=g.value)==null||s.validate(async d=>{if(d){const e=JSON.parse(JSON.stringify(a));e._id||Reflect.deleteProperty(e,"_id");const l=await(e._id?q(e):M({...e}));l.code==200?(x.success(l.message),C("on-submit"),r()):x.error(l.message)}})};return f({onReset:()=>{var s;(s=g.value)==null||s.resetFields(),a._id=""},submit:n,onUpdateForm:s=>{a._id=s._id,a.name=s.name,a.desc=s.desc}}),(s,d)=>{const e=i("el-input"),l=i("el-form-item"),m=i("el-form"),N=i("el-button"),B=i("el-dialog");return F(),z(B,{onClose:r,modelValue:b.value,"onUpdate:modelValue":d[2]||(d[2]=v=>b.value=v),draggable:"",title:`课程代码(${a._id?"修改":"新增"})`},{footer:t(()=>[V("span",G,[o(N,{onClick:r},{default:t(()=>[u("取消")]),_:1}),o(N,{type:"primary",onClick:n},{default:t(()=>[u("提交")]),_:1})])]),default:t(()=>[o(m,{"label-width":60,ref_key:"formRef",ref:g,model:a,rules:c},{default:t(()=>[o(l,{key:"1",prop:"name",label:"名称"},{default:t(()=>[o(e,{modelValue:a.name,"onUpdate:modelValue":d[0]||(d[0]=v=>a.name=v),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),o(l,{key:"2",label:"其他"},{default:t(()=>[o(e,{placeholder:"待定暂时不需要填写",disabled:""})]),_:1}),o(l,{key:"3",prop:"desc",label:"描述"},{default:t(()=>[o(e,{type:"textarea",modelValue:a.desc,"onUpdate:modelValue":d[1]||(d[1]=v=>a.desc=v),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),K={style:{"margin-top":"10px"}},X=T({__name:"index",setup(U){const f=w(),{data:h,getList:a}=O(),c=w(!1),C=j(),g=()=>{c.value=!0,S(()=>{var r;(r=f.value)==null||r.onReset()})},b=async r=>{const n=await E({_id:r._id});n?(x.success(n.message),a()):x.error(n.message)},y=r=>{c.value=!0,S(()=>{var n;(n=f.value)==null||n.onUpdateForm(r)})};return(r,n)=>{const p=i("el-button"),_=i("el-table-column"),s=i("el-popover"),d=i("el-table");return F(),I(L,null,[V("div",null,[o(p,{type:"primary",onClick:g},{default:t(()=>[u("新增课程代码")]),_:1})]),o(d,{data:k(h),border:""},{default:t(()=>[o(_,{align:"center",label:"名称",prop:"name"}),o(_,{align:"center",label:"创建时间",prop:"createTime"},{default:t(e=>{var l,m;return[u($((m=(l=k(C))==null?void 0:l.proxy)==null?void 0:m.$timeFormat(e.row.createTime)),1)]}),_:1}),o(_,{align:"center",label:"更新时间",prop:"updateTime"},{default:t(e=>{var l,m;return[u($((m=(l=k(C))==null?void 0:l.proxy)==null?void 0:m.$timeFormat(e.row.updateTime)),1)]}),_:1}),o(_,{align:"center",label:"描述",prop:"desc"}),o(_,{align:"center",label:"操作"},{default:t(e=>[o(p,{onClick:l=>y(e.row),type:"primary",size:"small"},{default:t(()=>[u("编辑")]),_:2},1032,["onClick"]),o(s,{visible:e.row.showpopover,trigger:"click",placement:"bottom",width:160},{reference:t(()=>[e.row.role!==1?(F(),z(p,{key:0,onClick:l=>e.row.showpopover=!0,size:"small",type:"danger"},{default:t(()=>[u("删除")]),_:2},1032,["onClick"])):P("",!0)]),default:t(()=>[V("p",null,"是否删除"+$(e.row.username),1),V("div",K,[o(p,{onClick:l=>e.row.showpopover=!1,type:"primary",size:"small"},{default:t(()=>[u("取消")]),_:2},1032,["onClick"]),o(p,{type:"danger",size:"small",onClick:l=>b(e.row)},{default:t(()=>[u(" 确定 ")]),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:1})]),_:1},8,["data"]),o(H,{onOnSubmit:k(a),ref_key:"CourseCode",ref:f,modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=e=>c.value=e)},null,8,["onOnSubmit","modelValue"])],64)}}});export{X as default};
