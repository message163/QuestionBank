import{a as F,r as $,d as z,v as I,b as S,x as W,y as j,k as x,w as r,E as q,c as i,o as b,g as U,f as l,h as p,z as B,e as M,B as G,u as V,F as O,q as T,t as R,A as H}from"./index-IDtxtGWq.js";const K=async t=>(await F.get("/api/user/list/",{params:t})).data,Q=async t=>(await F.get("/api/user/account",{params:t})).data,X=async t=>(await F.post("/api/user/create",t)).data,Y=async t=>(await F.patch(`/api/user/update/${t._id}`,t)).data,Z=async t=>(await F.delete(`/api/user/delete/${t._id}`)).data;var A=(t=>(t[t.admin=1]="admin",t[t.director=2]="director",t[t.teacher=3]="teacher",t[t.student=4]="student",t[t.guest=5]="guest",t))(A||{});const D=[{id:1,name:"管理员"},{id:2,name:"主任"},{id:3,name:"教师"},{id:4,name:"学生"},{id:5,name:"游客"}],L=()=>{let t=$([]);const _=async()=>{const a=await K();a.data.forEach(f=>{f.showpopover=!1}),t.value=a.data},g=a=>{var f;return((f=D.find(y=>y.id===a))==null?void 0:f.name)??""};return _(),{getList:_,getLeval:g,data:t}},ee={class:"dialog-footer"},te=z({__name:"create",props:{modelValue:{type:Boolean,required:!0,default:!1},modelModifiers:{}},emits:I(["on-submit"],["update:modelValue"]),setup(t,{expose:_,emit:g}){const a=S({username:"",account:"",password:"",leval:A.guest,_id:""}),f=S({username:[{required:!0,trigger:"change",message:"请输入名称"},{message:"请输入名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],account:[{required:!0,message:"请输入账号",trigger:"change"},{trigger:"blur",validator:(o,n,s)=>{if(!n)return s(new Error("请输入账号"));Q({keyWord:n}).then(e=>{e.data.code==200?s():s(new Error(e.data.message))}).catch(e=>{s(new Error(e))})}}],password:[{required:!0,message:"请输入密码",trigger:"change"},{message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],leval:[{required:!0,message:"请选择角色",trigger:"change",type:"number"},{message:"请选择角色",trigger:"blur",type:"number"}]}),y=g,k=$(),C=$(!1),E=W(t,"modelValue");j(E,o=>{C.value=o});const h=()=>{E.value=!1},c=()=>{var o;(o=k.value)==null||o.validate(async n=>{if(n){const s=JSON.parse(JSON.stringify(a));s._id?Reflect.deleteProperty(s,"password"):Reflect.deleteProperty(s,"_id");const e=await(s._id?Y(s):X({...s}));e.code==200?(q.success(e.message),y("on-submit"),h()):q.error(e.message)}})};return _({onReset:()=>{var o;(o=k.value)==null||o.resetFields(),a._id=""},submit:c,onUpdateForm:o=>{a._id=o._id,a.username=o.username,a.account=o.account,a.password=o.password,a.leval=o.leval}}),(o,n)=>{const s=i("el-input"),e=i("el-form-item"),d=i("el-option"),w=i("el-select"),J=i("el-form"),N=i("el-button"),P=i("el-dialog");return b(),x(P,{onClose:h,modelValue:C.value,"onUpdate:modelValue":n[4]||(n[4]=u=>C.value=u),draggable:"",title:"用户"},{footer:r(()=>[U("span",ee,[l(N,{onClick:h},{default:r(()=>[p("取消")]),_:1}),l(N,{type:"primary",onClick:c},{default:r(()=>[p("提交")]),_:1})])]),default:r(()=>[l(J,{ref_key:"formRef",ref:k,model:a,rules:f},{default:r(()=>[a._id?B("",!0):(b(),x(e,{key:"1",prop:"account",label:"账号"},{default:r(()=>[l(s,{modelValue:a.account,"onUpdate:modelValue":n[0]||(n[0]=u=>a.account=u),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1})),a._id?B("",!0):(b(),x(e,{key:"2",prop:"password",label:"密码"},{default:r(()=>[l(s,{type:"password",modelValue:a.password,"onUpdate:modelValue":n[1]||(n[1]=u=>a.password=u),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),l(e,{key:"3",prop:"username",label:"名称"},{default:r(()=>[l(s,{modelValue:a.username,"onUpdate:modelValue":n[2]||(n[2]=u=>a.username=u),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l(e,{key:"4",prop:"leval",label:"角色"},{default:r(()=>[l(w,{modelValue:a.leval,"onUpdate:modelValue":n[3]||(n[3]=u=>a.leval=u),placeholder:"请选择角色"},{default:r(()=>[(b(!0),M(O,null,G(V(D),u=>(b(),x(d,{label:u.name,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),ae={style:{"margin-top":"10px"}},le=z({__name:"index",setup(t){const _=$(),g=$(!1),a=H(),{data:f,getList:y,getLeval:k}=L(),C=()=>{g.value=!0,T(()=>{var c;(c=_.value)==null||c.onReset()})},E=async c=>{const m=await Z({_id:c._id});m?(q.success(m.message),y()):q.error(m.message)},h=c=>{g.value=!0,T(()=>{var m;(m=_.value)==null||m.onUpdateForm(c)})};return(c,m)=>{const v=i("el-button"),o=i("el-table-column"),n=i("el-popover"),s=i("el-table");return b(),M(O,null,[U("div",null,[l(v,{type:"primary",onClick:C},{default:r(()=>[p("新增用户")]),_:1})]),l(s,{border:"",data:V(f)},{default:r(()=>[l(o,{align:"center",label:"姓名",prop:"username"}),l(o,{align:"center",label:"账号",prop:"account"}),l(o,{align:"center",label:"权限",prop:"role"}),l(o,{align:"center",label:"角色",prop:"leval"},{default:r(e=>[p(R(V(k)(e.row.leval)),1)]),_:1}),l(o,{align:"center",label:"创建时间",prop:"createTime"},{default:r(e=>{var d,w;return[p(R((w=(d=V(a))==null?void 0:d.proxy)==null?void 0:w.$timeFormat(e.row.createTime)),1)]}),_:1}),l(o,{align:"center",label:"更新时间",prop:"updateTime"},{default:r(e=>{var d,w;return[p(R((w=(d=V(a))==null?void 0:d.proxy)==null?void 0:w.$timeFormat(e.row.updateTime)),1)]}),_:1}),l(o,{align:"center",label:"操作"},{default:r(e=>[l(v,{onClick:d=>h(e.row),type:"primary",size:"small"},{default:r(()=>[p("编辑")]),_:2},1032,["onClick"]),l(n,{visible:e.row.showpopover,trigger:"click",placement:"bottom",width:160},{reference:r(()=>[e.row.role!==1?(b(),x(v,{key:0,onClick:d=>e.row.showpopover=!0,size:"small",type:"danger"},{default:r(()=>[p("删除")]),_:2},1032,["onClick"])):B("",!0)]),default:r(()=>[U("p",null,"是否删除"+R(e.row.username),1),U("div",ae,[l(v,{onClick:d=>e.row.showpopover=!1,type:"primary",size:"small"},{default:r(()=>[p("取消")]),_:2},1032,["onClick"]),l(v,{type:"danger",size:"small",onClick:d=>E(e.row)},{default:r(()=>[p(" 确定 ")]),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:1})]),_:1},8,["data"]),l(te,{ref_key:"User",ref:_,onOnSubmit:V(y),modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=e=>g.value=e)},null,8,["onOnSubmit","modelValue"])],64)}}});export{le as default};
